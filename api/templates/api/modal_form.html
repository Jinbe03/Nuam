<div class="modal fade" id="modalForm" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <form id="formCalif" method="POST" action="{% url 'guardar_calificacion' %}">
        {% csrf_token %}
        <input type="hidden" name="id" id="calif_id" />

        <div class="modal-header">
          <h5 class="modal-title">Calificación</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">

            <div class="col-md-6">
              <label class="form-label">Empresa</label>
              <input class="form-control" id="empresa" name="empresa" required>
            </div>

            <div class="col-md-3">
              <label class="form-label">Periodo</label>
              <input type="month" class="form-control" id="periodo" name="periodo" required>
            </div>

            <div class="col-md-3">
              <label class="form-label">Tipo</label>
              <select id="tipo" name="tipo" class="form-select" required>
                <option value="IVA">IVA</option>
                <option value="Renta">Renta</option>
                <option value="IVA-Renta">IVA-Renta</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Calificación</label>
              <input class="form-control" id="calificacion" name="calificacion" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">Fuente / Archivo</label>
              <input class="form-control" id="fuente" name="fuente">
            </div>

            <div class="col-12">
              <label class="form-label">Observaciones</label>
              <textarea id="observaciones" name="observaciones" class="form-control" rows="2"></textarea>
            </div>

          </div>

          <!-- ============================= -->
          <!-- FACTORES PRINCIPALES -->
          <!-- ============================= -->
          <hr>
          <h6 class="fw-bold">Factores principales</h6>

          <div class="row g-3 mt-1">
            {% for campo, label in factores_principales %}
            <div class="col-md-4">
              <label class="form-label">{{ label }}</label>
              <input type="number" step="0.000001"
                     class="form-control"
                     name="{{ campo }}"
                     id="{{ campo }}">
            </div>
            {% endfor %}
          </div>

          <div class="text-center mt-3">
            <button type="button"
                    class="btn btn-outline-secondary btn-sm"
                    onclick="toggleAvanzados()">
              Mostrar Factores Avanzados ▼
            </button>
          </div>

          <!-- ============================= -->
          <!-- FACTORES AVANZADOS -->
          <!-- ============================= -->
          <div id="avanzadosContainer" style="display:none; margin-top:20px;">
            <h6 class="fw-bold text-muted">Factores avanzados</h6>

            <div class="row g-3">
              {% for campo, label in factores_avanzados %}
              <div class="col-md-4">
                <label class="form-label">{{ label }}</label>
                <input type="number" step="0.000001"
                       class="form-control"
                       name="{{ campo }}"
                       id="{{ campo }}">
              </div>
              {% endfor %}
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>

      </form>

    </div>
  </div>
</div>

<script>
function toggleAvanzados() {
  let box = document.getElementById("avanzadosContainer");
  box.style.display = (box.style.display === "none") ? "block" : "none";
}
</script>
